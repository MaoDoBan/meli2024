<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meliversário</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body, h1, h2, h3, figure, input{ margin: 0; }
    body{ background-color: #18181b; }
    main{
      display: flex;
      flex-direction: column;
      align-items: center;
      /* color: white; */
    }
    /* .press-start 2p-regular {
      font-family: "Press Start 2P", system-ui;
      font-weight: 400;
      font-style: normal;
    } */
    h1{
      font-family: "Press Start 2P", system-ui;
      margin: 16px;
      /* -webkit-text-fill-color: #0C4C96;
      -webkit-text-stroke: 1px #e5e5e5; */
      color: #1068cc;
    }
    a{
      text-decoration: none;
      color: inherit;
      padding: 4px;
      /* border: 2px solid white;
      border-radius: 5px;
      background-color: #4a4a4a; */
      margin: 13px;
    }
    a:hover{ color: #bbb; }
    #skinContainer{
      width: 300px;
      height: 500px;
    }
  </style>
</head>
<body>
  <main>
    <h1>Feliz Meliversário!</h1>
    <!-- <img src="imagens/showcase_skins.png" alt="banner"> -->

    <canvas id="skin_container"></canvas>

    <a href="https://twitter.com/HatsuyaDev">@HatsuyaDev é o artista que fez as encomendas acima</a>

    <script src="skinview3d.bundle.js"></script>
    <script>
      const skinParts = ["head", "body", "rightArm", "leftArm", "rightLeg", "leftLeg"];
      const skinLayers = ["innerLayer", "outerLayer"];
      const availableAnimations = {
        idle: new skinview3d.IdleAnimation(),
        walk: new skinview3d.WalkingAnimation(),
        run: new skinview3d.RunningAnimation(),
        fly: new skinview3d.FlyingAnimation()
      };

      let skinViewer;

      function obtainTextureUrl(id) {
        const urlInput = document.getElementById(id);
        const fileInput = document.getElementById(id + "_upload");
        const unsetButton = document.getElementById(id + "_unset");
        const file = fileInput.files[0];
        if (file === undefined) {
          if (!unsetButton.classList.contains("hidden")) {
            unsetButton.classList.add("hidden");
          }
          return urlInput.value;
        } else {
          unsetButton.classList.remove("hidden");
          urlInput.value = `Local file: ${file.name}`;
          urlInput.readOnly = true;
          return URL.createObjectURL(file);
        }
      }

      /*
      function initializeControls() {
        document.getElementById("canvas_width").addEventListener("change", e => skinViewer.width = e.target.value);
        document.getElementById("canvas_height").addEventListener("change", e => skinViewer.height = e.target.value);
        document.getElementById("fov").addEventListener("change", e => skinViewer.fov = e.target.value);
        document.getElementById("zoom").addEventListener("change", e => skinViewer.zoom = e.target.value);
        document.getElementById("global_light").addEventListener("change", e => skinViewer.globalLight.intensity = e.target.value);
        document.getElementById("camera_light").addEventListener("change", e => skinViewer.cameraLight.intensity = e.target.value);
        document.getElementById("animation_pause_resume").addEventListener("click", () => skinViewer.animation.paused = !skinViewer.animation.paused);
        document.getElementById("auto_rotate").addEventListener("change", e => skinViewer.autoRotate = e.target.checked);
        document.getElementById("auto_rotate_speed").addEventListener("change", e => skinViewer.autoRotateSpeed = e.target.value);
        for (const el of document.querySelectorAll('input[type="radio"][name="animation"]')) {
          el.addEventListener("change", e => {
            if (e.target.value === "") {
              skinViewer.animation = null;
            } else {
              skinViewer.animation = availableAnimations[e.target.value];
              skinViewer.animation.speed = document.getElementById("animation_speed").value;
            }
          });
        }
        document.getElementById("animation_speed").addEventListener("change", e => {
          if (skinViewer.animation !== null) {
            skinViewer.animation.speed = e.target.value;
          }
        });
        document.getElementById("control_rotate").addEventListener("change", e => skinViewer.controls.enableRotate = e.target.checked);
        document.getElementById("control_zoom").addEventListener("change", e => skinViewer.controls.enableZoom = e.target.checked);
        document.getElementById("control_pan").addEventListener("change", e => skinViewer.controls.enablePan = e.target.checked);
        for (const part of skinParts) {
          for (const layer of skinLayers) {
            document.querySelector(`#layers_table input[type="checkbox"][data-part="${part}"][data-layer="${layer}"]`)
              .addEventListener("change", e => skinViewer.playerObject.skin[part][layer].visible = e.target.checked);
          }
        }

        const initializeUploadButton = (id, callback) => {
          const urlInput = document.getElementById(id);
          const fileInput = document.getElementById(id + "_upload");
          const unsetButton = document.getElementById(id + "_unset");
          const unsetAction = () => {
            urlInput.readOnly = false;
            urlInput.value = "";
            fileInput.value = fileInput.defaultValue;
            callback();
          };
          fileInput.addEventListener("change", e => callback());
          urlInput.addEventListener("keydown", e => {
            if (e.key === "Backspace" && urlInput.readOnly) {
              unsetAction();
            }
          });
          unsetButton.addEventListener("click", e => unsetAction());
        };
        initializeUploadButton("skin_url", reloadSkin);
        initializeUploadButton("cape_url", reloadCape);
        initializeUploadButton("ears_url", reloadEars);
        initializeUploadButton("panorama_url", reloadPanorama);

        document.getElementById("skin_url").addEventListener("change", () => reloadSkin());
        document.getElementById("skin_model").addEventListener("change", () => reloadSkin());
        document.getElementById("cape_url").addEventListener("change", () => reloadCape());
        document.getElementById("ears_source").addEventListener("change", () => reloadEars());
        document.getElementById("ears_url").addEventListener("change", () => reloadEars());
        document.getElementById("panorama_url").addEventListener("change", () => reloadPanorama());

        for (const el of document.querySelectorAll('input[type="radio"][name="back_equipment"]')) {
          el.addEventListener("change", e => {
            if (skinViewer.playerObject.backEquipment === null) {
              // cape texture hasn't been loaded yet
              // this option will be processed on texture loading
            } else {
              skinViewer.playerObject.backEquipment = e.target.value;
            }
          });
        }

        document.getElementById("reset_all").addEventListener("click", () => {
          skinViewer.dispose();
          initializeViewer();
        });

        document.getElementById("nametag_text").addEventListener("change", () => reloadNameTag());
      }
      */

      function initializeViewer(id) {
        skinViewer = new skinview3d.SkinViewer({
          canvas: document.getElementById(id)
        });

        skinViewer.width = 300;
        skinViewer.height = 400;
        skinViewer.fov = 70;
        skinViewer.zoom = 0.9;
        skinViewer.globalLight.intensity = 3;
        skinViewer.cameraLight.intensity = 0.6;
        skinViewer.autoRotate = false; //document.getElementById("auto_rotate").checked;
        skinViewer.autoRotateSpeed = 0.3;
        skinViewer.animation = availableAnimations['idle'];
        skinViewer.animation.speed = 1;
        skinViewer.controls.enableRotate = true;
        skinViewer.controls.enableZoom = true;
        skinViewer.controls.enablePan = true;
        for (const part of skinParts) {
          for (const layer of skinLayers) {
            skinViewer.playerObject.skin[part][layer].visible = true;
          }
        }
        skinViewer.loadSkin("skin_amelie_1.png", {model: "slim", ears: false});
        skinViewer.loadCape(null);
        skinViewer.loadEars(null);
        skinViewer.background = null;
        skinViewer.nameTag = null;
      }

      //initializeControls();
      initializeViewer("skin_container");
    </script>
  </main>
</body>
</html>